# display(nmask)
nmask = opening(nmask, makeBrush(5, shape='disc'))
# display(nmask)
nmask = fillHull(nmask)
# display(nmask)
nmask = bwlabel(nmask)
display(nmask)
nmask = thresh(img, w=3, h=3, offset=0.2)
disc = makeBrush(7, "disc")
nmask <- dilate(nmask, disc)
# display(nmask)
nmask = opening(nmask, makeBrush(5, shape='disc'))
# display(nmask)
nmask = fillHull(nmask)
# display(nmask)
nmask = bwlabel(nmask)
display(nmask)
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th)
display(img_th, method = "raster")
nmask = bwlabel(img_th)
display(nmask)
display(colorLabels(nmask))
nmask = fillHull(img_th)
nmask = bwlabel(nmask)
display(nmask)
display(img_th, method = "raster")
nmask = opening(img_th, makeBrush(5, shape='disc'))
display(nmask)
nmask = opening(img_th, makeBrush(3, shape='disc'))
display(nmask)
nmask = opening(img_th, makeBrush(1, shape='disc'))
display(nmask)
nmask = opening(img_th, makeBrush(3, shape='disc'))
display(nmask)
nmask = fillHull(nmask)
display(nmask)
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th, method = "raster")
nmask = opening(img_th, makeBrush(3, shape='disc'))
display(nmask)
threshold = otsu(img)
img_th = img > threshold
blur = gblur(img_th, sigma = 5)
diplay(blur, method="raster")
display(blur, method="raster")
blur = gblur(img, sigma = 5)
threshold = otsu(blur)
img_th = blur > threshold
display(img_th, method="raster")
blur = gblur(img, sigma = 5)
threshold = otsu(blur)
img_th = img > threshold
display(img_th, method="raster")
blur = gblur(img, sigma = 3)
threshold = otsu(blur)
img_th = img > threshold
display(img_th, method="raster")
blur = gblur(img, sigma = 2)
threshold = otsu(blur)
img_th = img > threshold
display(img_th, method="raster")
blur = gblur(img, sigma = 6)
threshold = otsu(blur)
img_th = img > threshold
display(img_th, method="raster")
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(3, "disc")
er <- erode(img_th, disc)
display(er, method="raster")
disc = makeBrush(5, "disc")
er <- erode(img_th, disc)
display(er, method="raster")
disc = makeBrush(5, "disc")
er <- dilate(img_th, disc)
display(er, method="raster")
disc = makeBrush(7, "disc")
er <- dilate(img_th, disc)
display(er, method="raster")
disc = makeBrush(3, "disc")
er <- dilate(img_th, disc)
display(er, method="raster")
disc = makeBrush(5, "disc")
er <- dilate(img_th, disc)
display(er, method="raster")
nmask = fillHull(er)
display(nmask)
display(nmask)
nmask = opening(er, makeBrush(3, shape='disc'))
display(nmask)
nmask = fillHull(er)
display(nmask)
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(5, "disc")
er <- dilate(img_th, disc)
display(er, method="raster")
disc = makeBrush(31, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, all=TRUE)
disc = makeBrush(13, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, all=TRUE)
disc = makeBrush(5, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, all=TRUE)
disc = makeBrush(7, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, all=TRUE)
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, all=TRUE)
nmask = watershed( distmap(nuc_th), 2 )
display(nmask)
display(colorLabels(nmask))
filled = fillHull(nuc_th)
nmask = watershed( distmap(filled), 2 )
display(colorLabels(nmask))
filled = erode(filled, disk)
filled = erode(filled, disc)
display(filled)
nmask = watershed( distmap(filled), 2 )
display(colorLabels(nmask))
display( thresh(er, w=15, h=15, offset=0.05), all=TRUE )
nuc_th <- thresh(er, w=15, h=15, offset=0.05)
filled = fillHull(nuc_th)
filled = erode(filled, disc)
display(filled)
filled = fillHull(nuc_th)
display(filled)
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
# nuc_th <- thresh(er, w=15, h=15, offset=0.05)
filled = fillHull(nuc_th)
filled = erode(filled, disc)
display(filled)
filled = fillHull(nuc_th)
display(filled)
nmask = watershed( distmap(filled), 1 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), 0.1 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), 0.3 )
display(colorLabels(nmask))
threshold = otsu(img, c(0.25, 0.75))
img_th = img > threshold
threshold = otsu(img, range = c(0.25, 0.75))
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(5, "disc")
er <- closing(img_th, disc)
display(er, method="raster")
disc = makeBrush(7, "disc")
er <- closing(img_th, disc)
display(er, method="raster")
display(er, method="raster", all = TRUE)
nmask = watershed( distmap(filled), tolerance = 0.3, ext = 0.2 )
nmask = watershed( distmap(filled), tolerance = 0.3, ext = 3 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1, ext = 3 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1, ext = 50 )
display(colorLabels(nmask))
display(filled)
nmask = watershed( distmap(filled), tolerance = 3, ext = 5 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1, ext = 1 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1, ext = 0 )
nmask = watershed( distmap(filled), tolerance = 1, ext = 10 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1, ext = 1 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 0.5, ext = 1 )
display(colorLabels(nmask))
disc = makeBrush(31, "disc")
er <- closing(img_th, disc)
display(er, method="raster", all = TRUE)
disc = makeBrush(15, "disc")
er <- closing(img_th, disc)
display(er, method="raster", all = TRUE)
display(er, method="raster", 3)
display(er, method="raster", 2)
display(er, method="raster", 3)
display(er, method="raster", 1)
display(er, method="raster", 3)
display(er, method="raster")
disc = makeBrush(21, "disc")
er <- closing(img_th, disc)
display(er, method="raster")
disc = makeBrush(19, "disc")
er <- closing(img_th, disc)
display(er, method="raster")
display(er, method="raster", all = T)
display(brush)
display(disc)
disc = makeBrush(19, "Gaussian")
display(disc)
er <- whiteTopHat(img_th, disc)
display(er, method="raster", all = T)
disc = makeBrush(19, "disc")
er <- whiteTopHat(img_th, disc)
display(er, method="raster", all = T)
er <- blackTopHat(img_th, disc)
display(er, method="raster", all = T)
display(er, method="raster", 1)
display(er, method="raster", 2)
display(er, method="raster", 3)
disc = makeBrush(13, "disc")
er <- blackTopHat(img_th, disc)
display(er, method="raster", 3)
display(er, method="raster", 1)
disc = makeBrush(21, "disc")
er <- blackTopHat(img_th, disc)
display(er, method="raster", 1)
display(er)
disc = makeBrush(23, "disc")
er <- blackTopHat(img_th, disc)
display(er)
display(er,2)
display(er, method = "raster", 2)
display(er, method = "raster", 1)
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 1)
disc = makeBrush(51, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 1)
display(er, method = "raster", 3)
disc = makeBrush(7, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 3)
disc = makeBrush(11, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 3)
display(er, method = "raster", 2)
disc = makeBrush(21, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 2)
disc = makeBrush(23, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 2)
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 2)
filled = fillHull(er)
display(filled)
nmask = watershed( distmap(filled), tolerance = 0.5, ext = 1 )
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 2)
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 1)
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 0.5)
display(colorLabels(nmask))
colorLabels(nmask)
bwlabel(nmask)
max(bwlabel(nmask))
max(colorLabels(nmask))
display(bwlabel(nmask))
max(bwlabel(nmask))
bwlabel(distmap(filled))
max(bwlabel(distmap(filled)))
display(max(bwlabel(distmap(filled))))
display((bwlabel(distmap(filled))))
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 0.3)
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 0.4)
display(colorLabels(nmask))
nmask = watershed( distmap(filled), tolerance = 0.45)
display(colorLabels(nmask))
max(bwlabel(nmask))
nmask = watershed( distmap(filled), tolerance = 0.3)
max(bwlabel(nmask))
display(colorLabels(nmask))
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster", 2)
display(er, method = "raster")
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
filled = fillHull(er)
display(filled)
display(er, method = "raster")
display(filled)
display(er, method = "raster")
nmask = watershed( distmap(er), tolerance = 0.3)
display(colorLabels(nmask))
max(bwlabel(nmask))
nmask = watershed( distmap(er), tolerance = 0.5)
display(colorLabels(nmask))
max(bwlabel(nmask))
nmask = watershed( distmap(er), tolerance = 0.6)
display(colorLabels(nmask))
max(bwlabel(nmask))
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster")
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
# nuc_th <- thresh(er, w=15, h=15, offset=0.05)
# filled = fillHull(er)
# display(filled)
nmask = watershed( distmap(er), tolerance = 0.6)
display(colorLabels(nmask))
max(bwlabel(nmask))
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster")
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
# nuc_th <- thresh(er, w=15, h=15, offset=0.05)
# filled = fillHull(er)
# display(filled)
nmask = watershed( distmap(er), tolerance = 0.7)
display(colorLabels(nmask))
max(bwlabel(nmask))
nmask = watershed( distmap(er), tolerance = 0.8)
display(colorLabels(nmask))
max(bwlabel(nmask))
nmask = watershed( distmap(er), tolerance = 0.9)
display(colorLabels(nmask))
max(bwlabel(nmask))
display(img_th, method="raster")
display(colorLabels(nmask), method = "raster")
max(bwlabel(nmask))
img = readImage("IMG_5358.JPG")
threshold = otsu(img)
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster")
display(img_th, method="raster")
display(er, method = "raster")
disc = makeBrush(9, "disc")
disc = disc / sum(disc)
offset = 0.05
nuc_bg = filter2( er, disc )
nuc_th = er > nuc_bg + offset
display(nuc_th, method = "raster")
display(er, method = "raster")
display(colorLabels(nmask), method = "raster")
display(colorLabels(er), method = "raster")
label1 <- bwlabel(distmap(er))
max(label1)
label2 <- colorLabels(distmap(er))
max(label2)
display(label2, method = "raster")
label2 <- colorLabels((er))
display(label2, method = "raster")
display(colorLabels(er), method = "raster")
display(colorLabels(watershed( distmap(er))), method = "raster")
nmask = watershed( distmap(er), tolerance = 20)
max(bwlabel(nmask))
display(nmask)
display(colorLabels(nmask))
nmask = watershed( distmap(er), tolerance = 0.9)
display(colorLabels(nmask), method = "raster")
bwlabel(nmask)
max(bwlabel(nmask))
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster")
nmask = watershed( distmap(er), tolerance = 0.9)
display(colorLabels(nmask), method = "raster")
max(bwlabel(nmask))
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
display(img_th, method="raster")
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
display(er, method = "raster")
nmask = watershed( distmap(er), tolerance = 10)
display(colorLabels(nmask), method = "raster")
max(bwlabel(nmask))
max((nmask))
nmask = watershed( distmap(er), tolerance = 0.9)
display(colorLabels(nmask), method = "raster")
max((nmask))
img = medianFilter(img, 1)
display(img)
img = readImage("IMG_5358.JPG")
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
er <- erode(er, disc)
display(er)
disc31 = makeBrush(31, "disc")
disc5 = makeBrush(5, "disc")
er <- blackTopHat(img_th, disc)
er <- erode(er, disc5)
display(er)
disc31 = makeBrush(31, "disc")
disc5 = makeBrush(1, "disc")
er <- blackTopHat(img_th, disc)
er <- erode(er, disc5)
display(er)
disc31 = makeBrush(31, "disc")
disc5 = makeBrush(3, "disc")
er <- blackTopHat(img_th, disc)
er <- erode(er, disc5)
display(er)
# Change tolerance as needed
nmask = watershed( distmap(er), tolerance = 0.9)
# And check visually if labels are adequate
display(colorLabels(nmask), method = "raster")
# Then get the label count
max(nmask)
threshold = otsu(img)
img_th = img > threshold
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
# display(er)
# If the above ends up with artifacts (small unrelated objects)
# You can play with 'makeBrush' size and 'erode' until they're gone
#
# disc = makeBrush(3, "disc")
# er <- erode(er, disc)
# display(er)
# Change tolerance as needed
nmask = watershed( distmap(er), tolerance = 0.9)
# And check visually if labels are adequate
display(colorLabels(nmask), method = "raster")
# Then, finally, get the label count
max(nmask)
img = readImage("IMG_5358.JPG") # Small image, please
colorMode(img) = Grayscale
threshold = otsu(img)
img_th = img > threshold
disc = makeBrush(31, "disc")
er <- blackTopHat(img_th, disc)
# display(er)
# If the above ends up with artifacts (small unrelated objects)
# You can play with 'makeBrush' size and 'erode' until they're gone
disc = makeBrush(3, "disc")
er <- erode(er, disc)
# display(er)
# Change tolerance as needed
nmask = watershed( distmap(er), tolerance = 0.9)
# And check visually if labels are adequate
display(colorLabels(nmask), method = "raster")
# Then, finally, get the label count
max(nmask)
